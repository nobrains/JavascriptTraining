<html>
<body>
	<!-- <pre> -->
		<script type="text/javascript">
			function log(arg){
				document.writeln(arg+"<br/>");
			}
			function identity(x){
				return x;
			}
			function add(a,b){
				return a+b;
			}
			function sub(a,b){
				return a-b;
			}
			function mul(a,b){
				return a*b;
			}
			function identitfy(id){				
					return function(){
						return id;
					}
			}
			var three = identitfy(3);
			// log(three());
			function addf(arg){
				return function(id){
					return arg+id;
				}
			}
			// log(addf(3)(4));
			function liftf(operation){
				return function(a){
					return function(b){
						return operation(a,b);
					}
				}
			}
			var addf = liftf(add);
			// log(addf(3)(4));
			// log(liftf(mul)(5)(6));
			function curry(operation, a){
				return function(b){
					return operation(a,b);
				}
			}
			var add3 = curry(add,3);
			// log(add3(4));
			/*
			function inc1(a){
				return add(a,1);
			}
			// log(inc1(5));
			// log(inc1(inc1(5)));
			function inc2(a){
				return sub(a+2,1);
			}
			// log(inc2(5));
			// log(inc2(inc2(5)));

			function inc3(a){
				return mul(a+1,1);
			}
			// log(inc3(5));
			// log(inc3(inc3(5)));
			//fix this
			*/
			// var inc = liftf(add);
			// log(inc(5));
			function twice(operation){
				return function(a){
					return operation(a,a);//operation(a) operation(a);
				}
			}

			var doubl = twice(add);
			// log(doubl(11));
			var square = twice(mul);
			// log(square(11));

			function reverse(operation){
				return function(a,b){
					return operation(b,a);
				}
			}
			var bus = reverse(sub);
			// log(bus(3,2));
			function composeu(operation1, operation2){
				return function(a){
					return operation2(operation1(a));
				}
			}
			log("composeu(doubl,square)(5) = "+composeu(doubl,square)(5));
			function composeb(operation1, operation2){
				return function(a,b,c){
					return operation2(operation1(a,b),c);
				}
			}
			log("composeb(add,mul)(2,3,7) = "+composeb(add,mul)(2,3,7));
			function once(operation){
				var flag = true;
				return function(a,b){
					if(flag){
						flag = false;
						return operation(a,b);
					}
					return undefined;
				}
			}
			var add_once = once(add);
			log("add_once(3,4) once = "+add_once(3,4));
			log("add_once(3,4) twice = "+add_once(3,4));
			function fromTo(from,to){
				return function() {
					if(from<to){
						return from++;
					}
					return undefined;
				}
			}
			var index = fromTo(0,3);
			log("log(index()) 1 = "+index());
			log("log(index()) 2 = "+index());
			log("log(index()) 3 = "+index());
			log("log(index()) 4 = "+index());
			
			// function element(arr, to){
			// 	// var lo = 1;
			// 	// var hi = 3;
			// 	var counter = lo;
			// 	return function() {
			// 		if(lo<hi){
			// 			counter++;lo++;
			// 			return arr[counter-1];
			// 		}
			// 		return undefined;
			// 	}
			// }
			function element(array,gen){
				if(gen === undefined){
					gen = fromTo(0,array.length);
				}
				return function() {
					return array[gen()];
				}
			}
			var ele = element(['a','b','c','d'],fromTo(1,3));
			log("ele() 1 = " + ele());
			log("ele() 2 = " + ele());
			log("ele() 3 = " + ele());

			function collect(gen, arr){
				var counter = 0;		
				return function(){
					counter += 1;
					var g = gen();
					arr[counter] = g;
					return g;
				};
			}
			var array  = [],
				col = collect(fromTo(5,7), array);
			log("col() 1 " + col());	
			log("col() 2 " + col());	
			log("col() 3 " + col());	
			log(array);

			// function filter(gen, operation){
			// 	var arr = [];
			// 	var counter = 0;
			// 	return function() {
			// 		var g = gen();
			// 		// arr.push(g);
			// 		while(!operation(g)){
			// 			g = gen();
			// 		}
			// 		// if(operation(g)){
			// 			arr.push(g);
			// 		// }
			// 		counter++;
			// 		return arr[counter];
			// 		// return arr.length;
			// 	}
			// }
			function filter(gen, predicate){
				return function() {
					var value;
					do{
						value = gen();
					}while(
						value !== undefined && !predicate(value)
						);
					return value;
				}
			}
			var fil = filter(fromTo(0,5),
				function third(value){
					return (value % 3) === 0;
				});
			log("fil() 1 "+fil()); //0
			log("fil() 2 "+fil()); //3
			log("fil() 3 "+fil()); //undefined

			function concat(gen1, gen2){
				var arr = [],g1,g2;
				do{
					g1 = gen1();
					if(g1!==undefined){
					arr.push(g1);
				}
				}while(g1!==undefined)
				do{
					g2 = gen2();
					if(g2!==undefined){
					arr.push(g2);
				}
				}while(g2!==undefined)

				var counter = 0;
				return function() {
					return arr[counter++];
				};
			}
			var con = concat(fromTo(0,3),fromTo(0,2));
			log("con() 1 = "+ con() );
			log("con() 2 = "+ con() );
			log("con() 3 = "+ con() );
			log("con() 4 = "+ con() );
			log("con() 5 = "+ con() );
			log("con() 6 = "+ con() );

			function revocable(fun){
				var flag = true;
				return {
					invoke: function(id){
						if(flag) {
							return fun(id);
						}
						return undefined;	
					},
					revoke: function(){
						flag= false;
					}
				};
			}
			var rev = revocable(identity), 
				invoke = rev.invoke;
			log("invoke(7) = " + invoke(7));
			rev.revoke();
			log("invoke(8)= " + invoke(7));

			function counter(id){
				var temp = id;
				return {
					next: function(){
						return ++temp;
					},
					prev: function(){
						return --temp;
					}
				}
			}
			var object = counter(10),
				next = object.next;
				prev = object.prev;
			log("-----");
			log(next()); //11
			log(prev()); //10
			log(prev()); //9
			log(next()); //10
		</script>
	<!-- </pre> -->
</body>
</html>